<!DOCTYPE html>
<html>
  <head>
    <title>Epicby</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/css/styles.css">
    <link rel='stylesheet' href='//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css'>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
<script src="//cdn.jsdelivr.net/underscorejs/1.4.4/underscore-min.js" type="text/javascript"></script>
<script src="//cdn.jsdelivr.net/backbonejs/0.9.10/backbone-min.js" type="text/javascript"></script>

</head>
<body>
	<div class="container">
		<div class="row-fluid">
			<div class="span12">
				<h1>Welcome to Epicby</h1>
			</div>
		</div>
		<div class="row-fluid" id="main">
				
			</div>
		</div>
	</div><!-- container-->
</body>
<script>
	$(function($){	
		
		/*
		 * MODELS
		 */
		
		// The friendmodel represents one friend fetched from the database
		var Friend = Backbone.Model.extend({
			defaults: {
				name: "John",
				location: "Helsinki",
				upfo: true,
				message: "Golf at Pickala at 6ish?"
			}
		});
		
		/*
		 * COLLECTIONS
		 */
		
		var FriendList = Backbone.Collection.extend({
			model: Friend
		});

		/*
		 * VIEWS
		 */
		
		var FriendView = Backbone.View.extend({
			tagName: "li",
			initalize: function() {
				_.bindAll(this, 'render'); //every function that uses 'this' as the current object has to be in here.	
			},
			render: function() {
				$(this.el).html('<span>' + this.model.get('name') + ', ' + this.model.get('location') + ', ' + this.model.get('message') + '</span>');
				return this; 
			}
			
		});
		
		var MainView = Backbone.View.extend({
			el: $("#main"),
			events: {"click button#upfo" : 'addFriend'},
			
			initialize: function() {
				_.bindAll(this, 'render', 'addFriend', 'appendFriend');
				this.collection = new FriendList();
				this.collection.bind('add', this.appendFriend);
				this.render(this);
				return this;},

			render: function() {
				var self = this;
				$(this.el).append("<button id='upfo'>Say you're up for something!</button>");
				$(this.el).append("<ul></ul>");
				_(this.collection.models).each(function(friend){ // in case collection is not empty
				        self.appendFriend(friend);
					}, this);
				},
				
			addFriend: function() { 
				var friend = new Friend();
				this.collection.add(friend);
				},
			
			appendFriend: function(friend) {
				var friendView = new FriendView({
					model: friend
				});
				$('ul', this.el).append(friendView.render().el);
				}
				
		});
		var mainView = new MainView();
	});
	  
</script>
</html>